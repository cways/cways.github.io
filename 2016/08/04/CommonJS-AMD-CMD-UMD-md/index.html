<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>CommonJS_AMD_CMD_UMD.md | 拾遗</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">CommonJS_AMD_CMD_UMD.md</h1><a id="logo" href="/.">拾遗</a><p class="description">All time is no time when it is past.</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">CommonJS_AMD_CMD_UMD.md</h1><div class="post-meta">Aug 4, 2016<span> | </span><span class="category"><a href="/categories/Javascript/">-Javascript</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><p>##闭包方式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//filename: foo.js</span></div><div class="line"><span class="keyword">var</span> FUN=(<span class="function"><span class="keyword">function</span>(<span class="params">$</span>)</span>&#123;</div><div class="line">	<span class="comment">//method</span></div><div class="line">	<span class="function"><span class="keyword">function</span> <span class="title">myFunc</span>(<span class="params"></span>)</span>&#123;&#125;;</div><div class="line">	<span class="comment">//export method</span></div><div class="line">	<span class="keyword">return</span> myFunc();</div><div class="line">&#125;)(jquery);</div></pre></td></tr></table></figure>
<p>外部使用时，引入文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> fun = <span class="keyword">new</span> FUN();</div><div class="line">fun.myFunc();</div></pre></td></tr></table></figure>
<h2 id="CommonJS"><a href="#CommonJS" class="headerlink" title="CommonJS"></a>CommonJS</h2><p>CommonJS是服务器端模块的规范，Node.js采用了这个规范。</p>
<p>根据CommonJS规范，一个单独的文件就是一个模块。加载模块使用require方法，该方法读取一个文件并执行，最后返回文件内部的exports对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//private variable</span></div><div class="line"><span class="keyword">var</span> test = <span class="number">123</span>;</div><div class="line"><span class="comment">//public method</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foobar</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="keyword">this</span>.foo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</div><div class="line">	<span class="keyword">this</span>.bar = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> foobar = <span class="keyword">new</span> foobar();</div><div class="line">exports.foobar = foobar;</div></pre></td></tr></table></figure>
<p>exports对象上的方法和变量都是公有的;require方法默认读取js文件，所以可以省略js后缀。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> test = <span class="built_in">require</span>(<span class="string">'./foobar'</span>).foobar;</div><div class="line">test.bar();</div></pre></td></tr></table></figure>
<p>CommonJS加载模块时同步的，所以只有加载完成才能执行后来的操作。像Node.js主要用于服务器的编程，加载的模块文件一般都已经存在本地硬盘，所以加载起来比较快，不用考虑异步加载的方式，所以CommonJS规范比较适用。但如果时浏览器环境，要从服务器加载模块，这时就必须采用异步加载模式。所以有了AMD、CMD解决方案。</p>
<h2 id="AMD"><a href="#AMD" class="headerlink" title="AMD"></a>AMD</h2><p>AMD是RequireJS在推广过程中对模块定义的规范化产出。<br>AMD异步加载模块。它的模块支持对象、函数、构造器、字符串、JSON等各种类型的模块。</p>
<p>适用AMD模范适用define方法定义模块。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//通过数组引入依赖，回调函数通过形式参数引入依赖</span></div><div class="line">define([<span class="string">'someModule'</span>,<span class="string">'someModule2'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">someModule1,someModule2</span>)</span>&#123;</div><div class="line">	<span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		<span class="comment">//TODO</span></div><div class="line">		someModule1.test();</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> &#123;foo:foo&#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>AMD规范允许输出模块兼容CommonJS规范，这时define方法如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">require,exports,module</span>)</span>&#123;</div><div class="line">	<span class="keyword">var</span> reqModule = <span class="built_in">require</span>(<span class="string">'./someModule'</span>);</div><div class="line">	reqModule.test();</div><div class="line">	exports.asplode = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		<span class="comment">//TODO something</span></div><div class="line">	&#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>定义的第一个部分是一个依赖数组，第二部分是回调函数，只有当依赖的组件可用时（像RequireJS那样的脚本加载器会负责这一部分，包括找到文件路径）回调函数才会被执行。</p>
<p>注意，依赖组件和变量的顺序是一一对应的（例如，jquery-&gt;<code>$</code>,underscore-&gt;<code>_</code>）。</p>
<p>同时，我们可以用任意的变量名来表示依赖组件。例如我们把<code>$</code>改成<code>$$</code>。<br>在函数体里面的所有对jQuery的引用都由<code>$</code>变成<code>$$</code>。<br>最重要的是你不能在回调函数外面使用变量<code>$</code>和<code>_</code>，因为它相对其它代码是独立的。这正是模块画的目的所在！</p>
<h2 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h2><p>CMD是SeaJS在推广过程中对模块定义的规范化产出。</p>
<p>CMD与AMD的区别有以下几点：</p>
<ul>
<li>对于依赖的模块AMD是提前执行，CMD是延迟执行。不过RequireJS从2.0开始，也改成可以延迟执行（根据写法不同，处理方式不同）。</li>
<li>CMD推崇依赖就近，AMD推崇依赖前置。虽然AMD也支持CMD写法，但是依赖前置是官方文档的默认模块定义写法。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//AMD</span></div><div class="line">define([<span class="string">'./a'</span>,<span class="string">'./b'</span>],<span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>)</span>&#123;</div><div class="line">	<span class="comment">//依赖一开始就写好</span></div><div class="line">	a.test();</div><div class="line">	b.test();</div><div class="line">&#125;);</div><div class="line"><span class="comment">//CMD</span></div><div class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">require,exports,module</span>)</span>&#123;</div><div class="line">	<span class="comment">//依赖可以就近书写</span></div><div class="line">	<span class="keyword">var</span> a = <span class="built_in">require</span>(<span class="string">'./a'</span>);</div><div class="line">	a.test();</div><div class="line">	<span class="comment">//软依赖</span></div><div class="line">	<span class="keyword">if</span>(status)&#123;</div><div class="line">		<span class="keyword">var</span> b = <span class="built_in">require</span>(<span class="string">'./b'</span>);</div><div class="line">		b.test();</div><div class="line">	&#125;</div><div class="line">&#125;);</div><div class="line"><span class="string">``</span><span class="string">` </span></div><div class="line"></div><div class="line">+ AMD的API默认是一个当多个用，CMD严格的区分推崇职责单一。例如：AMD里require分全局的和局部的。CMD里面没有全局的require，提供seajs.use()来实现模块系统的加载启动。CMD里每个API都简单纯粹。</div><div class="line"></div><div class="line">&gt;RequireJS和Sea.js都是模块加载器，倡导模块化开发理念，核心价值是让JavaScript的模块化开发变得简单自然。</div><div class="line"></div><div class="line">## UMD:通用模块规范</div><div class="line"></div><div class="line">UMD是AMD和CommonJS的糅合。AMD：浏览器第一的原则发展、异步加载模块；CommonJS：模块以服务器第一原则发展，选择同步加载，它的模块不需包装（unwrapped modules）。</div><div class="line"></div><div class="line">不得不承认，这个模式略难看，但是兼容了AMD和CommonJS，同时还支持老式的“全局”变量规范：</div><div class="line"></div><div class="line">`<span class="string">``</span>javascript</div><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">root,factory</span>)</span>&#123;</div><div class="line">	<span class="keyword">if</span>(<span class="keyword">typeof</span> define === <span class="string">'function'</span> &amp;&amp; define.amd)&#123;</div><div class="line">		<span class="comment">//AMD</span></div><div class="line">		define([<span class="string">'jquery'</span>],factory);</div><div class="line">	&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">typeof</span> exports === <span class="string">'object'</span>)&#123;</div><div class="line">		<span class="comment">//Node,CommonJS之类</span></div><div class="line">		<span class="built_in">module</span>.exports = factory(<span class="built_in">require</span>(<span class="string">'jquery'</span>));</div><div class="line">	&#125;<span class="keyword">else</span>&#123;</div><div class="line">		<span class="comment">//浏览器全局变量（root即是window）</span></div><div class="line">		root.returnExports = factory(root.jQuery);</div><div class="line">	&#125;</div><div class="line">&#125;(<span class="keyword">this</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$</span>)</span>&#123;</div><div class="line">	<span class="comment">//method</span></div><div class="line">	<span class="function"><span class="keyword">function</span> <span class="title">myFunc</span>(<span class="params"></span>);</span></div><div class="line">	//<span class="title">export</span></div><div class="line">	<span class="title">return</span> <span class="title">myFunc</span>;</div><div class="line">&#125;));</div></pre></td></tr></table></figure>
<p>下面是更为复杂的例子，它依赖多个组件并暴露多个方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">root,factory</span>)</span>&#123;</div><div class="line">	<span class="keyword">if</span>(<span class="keyword">typeof</span> define === <span class="string">'function'</span> &amp;&amp; define.amd)&#123;</div><div class="line">		<span class="comment">//AMD</span></div><div class="line">		define([<span class="string">'jquery'</span>,<span class="string">'underscore'</span>],factory);</div><div class="line">	&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">typeof</span> exports === <span class="string">'object'</span>)&#123;</div><div class="line">		<span class="comment">//Node,CMD之类</span></div><div class="line">		<span class="built_in">module</span>.exports = factory(<span class="built_in">require</span>(<span class="string">'jquery'</span>),<span class="built_in">require</span>(<span class="string">'underscore'</span>));</div><div class="line">	&#125;<span class="keyword">else</span>&#123;</div><div class="line">		<span class="comment">//浏览器全局（root即为window）</span></div><div class="line">		root.returnExports = factory(root.jQuery,root._);</div><div class="line">	&#125;</div><div class="line">&#125;(<span class="keyword">this</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$,_</span>)</span>&#123;</div><div class="line">	<span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;&#125;;</div><div class="line">	<span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>)</span>&#123;&#125;;</div><div class="line">	<span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>)</span>&#123;&#125;;</div><div class="line">	</div><div class="line">	<span class="keyword">return</span> &#123;</div><div class="line">		b:b,</div><div class="line">		c:c</div><div class="line">	&#125;</div><div class="line">&#125;));</div></pre></td></tr></table></figure></div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://cways.github.io/2016/08/04/CommonJS-AMD-CMD-UMD-md/" data-id="cirg34hzg00003ywz44itfg3b" class="article-share-link">分享到</a><div class="tags"><a href="/tags/Javascript/">-Javascript</a></div><div class="post-nav"><a href="/2016/07/24/线型链表/" class="next">线型链表</a></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://cways.github.io"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Javascript/">-Javascript</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mybatis/">Mybatis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据结构与算法/">数据结构与算法</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Javascript/" style="font-size: 15px">-Javascript</a> <a href="/tags/Javascript/" style="font-size: 15px">Javascript</a> <a href="/tags/JAVA/" style="font-size: 15px">JAVA</a> <a href="/tags/MyBatis/" style="font-size: 15px">MyBatis</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/08/04/CommonJS-AMD-CMD-UMD-md/">CommonJS_AMD_CMD_UMD.md</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/24/线型链表/">线型链表</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/13/使用MyBatis-Generator自动创建代码/">使用MyBatis Generator自动创建代码</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/12/hello-world/">Hello World</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">拾遗.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>